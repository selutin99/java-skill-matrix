# Что такое Read\Write concern и eventually consistency

## 1. Read Concern (уровень согласованности при чтении)

* Определяет, **какие данные** клиент может прочитать из MongoDB.
* Варианты:

    1. **local** (по умолчанию) — читаем данные с ближайшего узла, не ждём репликации.
    2. **available** — читаем даже при недоступности части реплик (устаревшие данные допустимы).
    3. **majority** — читаем только данные, подтверждённые большинством реплик (гарантия согласованности).
    4. **linearizable** — строгая согласованность: чтение только после подтверждения записи на majority и выборки с primary.
    5. **snapshot** — согласованная "снимок-операция" (для транзакций).

---

## 2. Write Concern (уровень подтверждения записи)

* Определяет, **когда запись считается успешной**.
* Варианты:

    1. **w:1** — подтверждение только от primary (по умолчанию).
    2. **w\:majority** — запись подтверждается, когда её получили большинство узлов.
    3. **w\:n** — запись подтверждается после репликации на n узлов.
    4. Дополнительно: `j:true` — ждать записи в журнал (journal) на диске.

---

## 3. Eventual Consistency (согласованность в конечном итоге)

* Свойство распределённых систем (BASE).
* При записи данные сначала появляются на **primary**, потом асинхронно реплицируются на **secondary**.
* В момент времени разные узлы могут содержать разные версии данных.
* Но через некоторое время (при отсутствии новых сбоев) все узлы приходят к единому состоянию.
* Типичный режим для NoSQL-систем, где важна доступность и скорость (CAP: **AP**).

---

## 4. Применение на практике

* Если важна скорость → `readConcern: local`, `writeConcern: 1`.
* Если важна консистентность (например, финансы) → `readConcern: majority`, `writeConcern: majority, j:true`.
* Если допустимо «устаревшее чтение» ради скорости → `readPreference: secondary` + `readConcern: local` (eventual consistency).

---

## 5. Выжимка для собеседования

* **Write concern** — определяет, сколько реплик должно подтвердить запись.
* **Read concern** — определяет, насколько «свежие» данные можно читать.
* **Eventual consistency** — модель, при которой данные могут быть разными на узлах в момент времени, но со временем синхронизируются.
* В MongoDB можно настраивать баланс между скоростью и надёжностью с помощью этих параметров.
