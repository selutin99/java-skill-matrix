# Что такое WireTiger в MongoDB и как вид блокировок он использует

## 1. Что такое **WiredTiger**

* **WiredTiger** — это основной **storage engine** (механизм хранения) в MongoDB начиная с версии **3.2** (по умолчанию с 3.2, начиная с 3.0 он появился как опция).
* Отвечает за:

    * как данные записываются и читаются с диска,
    * организацию кэшей, журналов, индексов,
    * контроль параллельности доступа.
* Основные особенности:

    * **Документ-уровневая блокировка** (fine-grained concurrency).
    * Поддержка **MVCC (multi-version concurrency control)** → транзакции с read snapshot.
    * Сжатие данных (Snappy, Zlib, Zstd).
    * Write-ahead logging (журнал для восстановления после сбоев).

---

## 2. Как WiredTiger работает с блокировками

* До WiredTiger MongoDB использовала **global lock** и затем **database-level lock** (грубая блокировка, сильно ограничивала параллелизм).
* WiredTiger ввёл **document-level locking**:

    * Одновременные операции могут выполняться над разными документами одной коллекции.
    * Блокировка не коллекции/БД целиком, а конкретного документа.
* Внутренне WiredTiger применяет комбинацию:

    1. **Optimistic concurrency (MVCC)** — чтения не блокируются записями (читатели не мешают писателям).
    2. **Document-level locks** — защита от одновременной записи в один и тот же документ.
    3. **Collection-level intent locks** — мета-блокировки, чтобы операции вроде создания индекса не конфликтовали с обычными запросами.

---

## 3. Выжимка для собеседования

* **WiredTiger** — это основной движок хранения в MongoDB.
* Использует **MVCC** и **блокировки на уровне документа** (вместо глобальных/коллекционных).
* Преимущество: высокая параллельность, читатели не блокируют писателей.
* При одновременной записи в один документ — действует document-level lock.
