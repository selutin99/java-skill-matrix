# Зачем нужна оркестрация, какие функции выполняет оркестратор

## 1. Зачем нужна оркестрация контейнеров

* Один контейнер запустить просто (`docker run`).
* Но в реальных системах:

    * десятки–сотни микросервисов,
    * нужно **масштабирование** (горизонтальное, авто),
    * **отказоустойчивость** (рестарт упавших, замена узлов),
    * **сети** и **балансировка**,
    * управление **секретами и конфигами**,
    * **обновления без простоя** (rolling update, canary, blue-green).

**Оркестратор** = система, которая автоматизирует жизненный цикл множества контейнеров на кластере серверов.

---

## 2. Основные функции оркестратора

### 2.1. Планирование (Scheduling)

* Определяет, на каких узлах кластера запускать контейнеры.
* Учитывает ресурсы (CPU, RAM), метки узлов, анти-аффинити, приоритеты.

### 2.2. Масштабирование

* Ручное: задали число реплик.
* Авто: HPA (Horizontal Pod Autoscaler в Kubernetes) по CPU/RAM/метрикам.

### 2.3. Отказоустойчивость

* Мониторинг состояния контейнеров.
* Автоматический рестарт при сбое.
* Перезапуск на другом узле, если хост упал.

### 2.4. Балансировка нагрузки

* Создание сервисов с **виртуальным адресом**.
* Распределение трафика между репликами.
* Service discovery (DNS, API).

### 2.5. Управление конфигурациями и секретами

* Передача переменных окружения, файлов конфигурации.
* Секреты (пароли, ключи) — хранение и безопасная выдача контейнерам.

### 2.6. Обновления и релизы

* Rolling update: постепенная замена.
* Canary release: часть трафика на новую версию.
* Blue-green: переключение между средами.

### 2.7. Сеть и сервис-связи

* Создание внутренних сетей между контейнерами.
* Изоляция (namespaces).
* Ingress (внешний доступ).

### 2.8. Хранение данных

* Подключение **volume’ов** к контейнерам.
* Dynamic provisioning (автоматическое выделение томов).

### 2.9. Безопасность и политика

* RBAC (разграничение доступа).
* Подписи образов, политика запуска.
* Ограничения ресурсов (cgroups).

### 2.10. Мониторинг и логирование

* Метрики состояния сервисов.
* Сбор логов контейнеров.
* Интеграция с Prometheus, ELK.

---

## 3. Популярные оркестраторы

* **Kubernetes** — де-факто стандарт (GKE, EKS, AKS).
* **Docker Swarm** — встроенный в Docker, проще, но ограничен.
* **Nomad (HashiCorp)** — универсальный (контейнеры + бинарники).
* В облаках: AWS ECS, Google Cloud Run, Azure Container Apps.

---

## 4. Выжимка для собеседования

* **Зачем оркестрация**: когда контейнеров много — нужны автоматизация, масштабирование, отказоустойчивость, сети, секреты, обновления без простоя.
* **Функции оркестратора**:

    * планирование и запуск контейнеров на узлах,
    * масштабирование и авто-скейлинг,
    * мониторинг и самовосстановление,
    * балансировка и service discovery,
    * управление конфигами и секретами,
    * обновления без простоя (rolling, blue-green, canary),
    * работа с volume’ами,
    * безопасность (RBAC, лимиты ресурсов),
    * централизованные метрики и логи.
* **Kubernetes** — основной промышленный стандарт.
