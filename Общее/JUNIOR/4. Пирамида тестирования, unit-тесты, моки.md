# 4. Пирамида тестирования, unit-тесты, моки

*Пирамида тестирования* — это концепция, помогающая распределить тесты в проекте так, чтобы поддерживать баланс между скоростью выполнения тестов, их надежностью и объемом покрытия кода. Она состоит из нескольких уровней: *юнит-тестов (unit tests), интеграционных тестов и end-to-end тестов (или UI-тестов)*. Каждый из этих уровней играет свою роль в проверке качества системы. Давайте рассмотрим каждый из них.

**Уровни пирамиды тестирования**
1. *Юнит-тесты (Unit tests)*. Юнит-тесты находятся на основании пирамиды и составляют её основную часть. Эти тесты проверяют отдельные модули или функции в изоляции от остальной системы, что делает их быстрыми и дешевыми в выполнении. Юнит-тесты позволяют разработчику проверять корректность логики небольших частей кода (обычно отдельных классов или методов), не зависящих от внешних сервисов и данных. Например: проверка функции расчета налога для конкретного типа товара или проверки алгоритма, отвечающего за валидацию данных в форме;
2. *Интеграционные тесты (Integration tests)*. Интеграционные тесты проверяют взаимодействие между несколькими модулями, а также их работу с внешними зависимостями — базами данных, API и сервисами. Хотя они медленнее и сложнее в поддержке, чем юнит-тесты, их цель — убедиться, что компоненты корректно взаимодействуют друг с другом. Например: тестирование взаимодействия системы с базой данных: выполнение запросов на создание и получение данных;
3. *End-to-End (e2e) тесты или UI-тесты*. Эти тесты находятся на вершине пирамиды, так как они наиболее затратны и медленны. E2E тесты проверяют систему целиком, симулируя реальное поведение пользователя. Они проверяют функциональность от начала до конца, включая работу фронтенда, бэкенда, баз данных и других систем, имитируя сценарии использования. Например: проверка всей последовательности оформления заказа на сайте, от выбора товара до завершения покупки.

**Роль моков (mocks) в тестировании**
Моки (mock objects) используются, в основном, на уровне юнит-тестирования, чтобы изолировать тестируемый код от внешних зависимостей. Моки заменяют реальный объект заглушкой, которая позволяет имитировать поведение реального компонента. Это важно, когда тестируемый компонент взаимодействует с внешними системами, такими как базы данных, сторонние сервисы или API, поскольку мок позволяет избежать фактического обращения к этим зависимостям. 
Если юнит-тест должен проверить, как компонент реагирует на ответ от API, то вместо реального API можно использовать мок, который имитирует возвращаемые значения. Это позволит контролировать тестовую среду и проверить работу функции в разных сценариях (успешный ответ, ошибка и т.д.).

**Как использовать пирамиду тестирования**
Следуя пирамиде, в проекте предпочтение отдается большому количеству юнит-тестов, средней доле интеграционных тестов и небольшому числу e2e-тестов. Такое распределение снижает затраты на тестирование, позволяет быстрее выявлять ошибки и упрощает отладку кода.
