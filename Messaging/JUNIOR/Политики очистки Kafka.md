# Какие есть политики очистки в Kafka

## 1. Политики очистки логов в Kafka

Сообщения в Kafka не удаляются сразу после чтения консумером — они хранятся в партиции до тех пор, пока не сработает политика очистки. Очистка регулируется параметрами **`log.cleanup.policy`** на уровне топика.

---

### Основные политики

1. **`delete` (по умолчанию)**

    * Сообщения удаляются по времени или по размеру.
    * Настраивается через параметры:

        * `retention.ms` — время хранения сообщений (по умолчанию 7 дней).
        * `retention.bytes` — максимальный размер лога партиции (например, 1 GB).
    * Когда лимит превышен → старые сегменты удаляются.

   ✅ Используется, когда нужны только новые данные, а старые — не нужны (например, логи, метрики).

---

2. **`compact` (лог-компакция)**

    * Kafka хранит **только последнее сообщение для каждого ключа**.
    * Старые версии записей с тем же ключом постепенно удаляются во время компакции.
    * Сообщения без ключа **никогда не удаляются**.

   ✅ Используется, когда нужно хранить **актуальное состояние** сущностей:

    * последние настройки,
    * справочники (например, “id пользователя → профиль”),
    * кеш данных.

---

3. **Смешанный режим (`delete,compact`)**

    * Можно указать обе политики сразу.
    * Kafka будет сначала выполнять компакцию, а потом удалять старые сегменты по `retention.ms` или `retention.bytes`.

   ✅ Применяется, когда нужно и хранить последнее состояние по ключам, и при этом ограничивать общий объём/время хранения.

---

## 2. Дополнительные механизмы очистки

* **`log.segment.bytes`** — максимальный размер сегмента. Когда он заполнен, Kafka начинает новый сегмент.
* **`log.segment.ms`** — максимальное время жизни сегмента, после которого он закрывается.
* **`delete.retention.ms`** — сколько хранить “удалённые ключи” (tombstone records) в режиме компакции.

---

## 3. Выжимка для собеседования

* В Kafka есть две основные политики очистки:

    * **`delete`** — хранить данные ограниченное время или до определённого размера.
    * **`compact`** — хранить только последнее значение по ключу.
* Можно комбинировать обе (`delete,compact`).
* Очистка настраивается через параметры `retention.ms`, `retention.bytes`, `log.segment.bytes` и др.
