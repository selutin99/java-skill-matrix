# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏ –¥–ª—è —á–µ–≥–æ –æ–Ω–∞ –Ω—É–∂–Ω–∞, atomic –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, volatile, happens before

## **1. –î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**

–í –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω—É–∂–Ω–∞ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –¥–≤—É—Ö –ø—Ä–æ–±–ª–µ–º:

1. **–ì–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö (race condition)** ‚Äî –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–∏—Ç–∞—é—Ç/–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –æ–¥–Ω—É –∏ —Ç—É –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
2. **–í–∏–¥–∏–º–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π** ‚Äî –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –Ω–æ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ –Ω–µ —É–≤–∏–¥–∏—Ç —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–∑-–∑–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –≤ CPU-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ö –∏–ª–∏ –∫—ç—à–µ.

–ü—Ä–∏–º–µ—Ä –≥–æ–Ω–∫–∏:

```java
class Counter {
    private int count = 0;

    public void increment() {
        count++; // –ù–µ –∞—Ç–æ–º–∞—Ä–Ω–æ! = —á—Ç–µ–Ω–∏–µ + –ø—Ä–∏–±–∞–≤–ª–µ–Ω–∏–µ + –∑–∞–ø–∏—Å—å
    }

    public int getCount() {
        return count;
    }
}
```

–ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –≤—ã–∑–æ–≤—É—Ç `increment()`, –≤–æ–∑–º–æ–∂–Ω—ã –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã.

---

## **2. volatile**

`volatile` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:

* **–í–∏–¥–∏–º–æ—Å—Ç—å**: –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –≤–∏–¥—è—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.
* **–ó–∞–ø—Ä–µ—Ç reorder‚Äô–∏–Ω–≥–∞** —á—Ç–µ–Ω–∏–π/–∑–∞–ø–∏—Å–µ–π —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

**–ß–µ–≥–æ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç**: –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π (—Ç.–µ. `count++` –≤—Å—ë –µ—â—ë –Ω–µ–±–µ–∑–æ–ø–∞—Å–µ–Ω).

–ü—Ä–∏–º–µ—Ä:

```java
volatile boolean running = true;

public void run() {
    while (running) {
        // ...
    }
}

public void stop() {
    running = false; // —Å—Ä–∞–∑—É —É–≤–∏–¥—è—Ç –≤—Å–µ –ø–æ—Ç–æ–∫–∏
}
```

`volatile` –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è **—Ñ–ª–∞–≥–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**, **–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**.

---

## **3. synchronized**

` synchronized` —Ä–µ—à–∞–µ—Ç –æ–±–µ –ø—Ä–æ–±–ª–µ–º—ã:

* –î–µ–ª–∞–µ—Ç –±–ª–æ–∫ –∫–æ–¥–∞ **–∞—Ç–æ–º–∞—Ä–Ω—ã–º** –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤.
* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç **happens-before** –º–µ–∂–¥—É –≤—ã—Ö–æ–¥–æ–º –∏–∑ –±–ª–æ–∫–∞ –æ–¥–Ω–∏–º –ø–æ—Ç–æ–∫–æ–º –∏ –≤—Ö–æ–¥–æ–º –≤ –±–ª–æ–∫ –¥—Ä—É–≥–∏–º.

–ü—Ä–∏–º–µ—Ä:

```java
class Counter {
    private int count = 0;

    public synchronized void increment() {
        count++;
    }

    public synchronized int getCount() {
        return count;
    }
}
```

–¢—É—Ç `increment()` –∏ `getCount()` –∑–∞—â–∏—â–µ–Ω—ã –º–æ–Ω–∏—Ç–æ—Ä–æ–º —Ç–µ–∫—É—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (`this`).

---

## **4. Atomic –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**

–ö–ª–∞—Å—Å `java.util.concurrent.atomic.*`:

* –†–µ–∞–ª–∏–∑—É–µ—Ç **–∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, –∏—Å–ø–æ–ª—å–∑—É—è **CAS** (compare-and-swap) –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.
* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç **–≤–∏–¥–∏–º–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π** (–≤—Å–µ –º–µ—Ç–æ–¥—ã –≤–µ–¥—É—Ç —Å–µ–±—è —Ç–∞–∫, –∫–∞–∫ –±—É–¥—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `volatile`).

–ü—Ä–∏–º–µ—Ä:

```java
AtomicInteger counter = new AtomicInteger(0);

public void increment() {
    counter.incrementAndGet(); // –∞—Ç–æ–º–∞—Ä–Ω–æ + –≤–∏–¥–∏–º–æ—Å—Ç—å
}
```

–ü–ª—é—Å—ã:

* –ë—ã—Å—Ç—Ä–µ–µ, —á–µ–º `synchronized`, –ø—Ä–∏ –Ω–∏–∑–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏.
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π: `incrementAndGet`, `compareAndSet`, `addAndGet` –∏ –¥—Ä.

---

## **5. Happens-before**

–≠—Ç–æ **–ø—Ä–∞–≤–∏–ª–æ –≤–∏–¥–∏–º–æ—Å—Ç–∏** –≤ Java Memory Model (JMM):

> –ï—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ A **happens-before** –¥–µ–π—Å—Ç–≤–∏—è B, —Ç–æ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ A, –±—É–¥—É—Ç –≤–∏–¥–Ω—ã B, –∏ A –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–æ B –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

–û—Å–Ω–æ–≤–Ω—ã–µ happens-before –≥–∞—Ä–∞–Ω—Ç–∏–∏:

1. **–í –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ** ‚Äî –ø–æ—Ä—è–¥–æ–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (—Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã).
2. **–ú–æ–Ω–∏—Ç–æ—Ä—ã (`synchronized`)**:

    * –í—ã—Ö–æ–¥ –∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞ **happens-before** –≤—Ö–æ–¥–∞ –≤ –Ω–µ–≥–æ –¥—Ä—É–≥–∏–º –ø–æ—Ç–æ–∫–æ–º.
3. **volatile**:

    * –ó–∞–ø–∏—Å—å –≤ volatile-–ø–µ—Ä–µ–º–µ–Ω–Ω—É—é **happens-before** –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —á—Ç–µ–Ω–∏—è —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.
4. **–ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞**:

    * –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –ø–æ—Ç–æ–∫–µ, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç `Thread.start()`, **happens-before** –¥–µ–π—Å—Ç–≤–∏—è –≤ –Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ.
5. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞**:

    * –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –ø–æ—Ç–æ–∫–µ **happens-before** –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ `Thread.join()` –≤ –¥—Ä—É–≥–æ–º –ø–æ—Ç–æ–∫–µ.

---

## **6. –ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**

| –ó–∞–¥–∞—á–∞                                                       | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç                     |
| ------------------------------------------------------------ | ------------------------------ |
| –ù—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∞—Ç–æ–º–∞—Ä–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —Å—á–µ—Ç—á–∏–∫                      | `AtomicInteger`                |
| –ù—É–∂–Ω–æ –∞—Ç–æ–º–∞—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –ø—Ä–∏–º–∏—Ç–∏–≤–∞ –∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ | `volatile`                     |
| –ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏                  | `synchronized` –∏–ª–∏ `Lock`      |
| –í—ã—Å–æ–∫–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–Ω–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å              | `ReentrantLock`, `StampedLock` |
| –§–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞                                       | `volatile boolean`             |

---

üìå **–í–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç –¥–ª—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–π** ‚Äî `volatile` **–Ω–µ** –¥–µ–ª–∞–µ—Ç `count++` –±–µ–∑–æ–ø–∞—Å–Ω—ã–º, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ —Ç—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ (read, modify, write). –î–ª—è —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞–µ–≤ –∏–ª–∏ `synchronized`, –∏–ª–∏ `AtomicInteger`.
