# Профайлинг и инструменты профайлинга

## **1. Что такое профайлинг**

**Профайлинг** — это процесс **сбора и анализа данных о работе приложения во время выполнения (runtime)**.
Он показывает:

* **сколько времени занимают методы** (CPU time);
* **как используется память** (heap, GC, объекты);
* **где происходят блокировки потоков** (thread contention);
* **какие вызовы чаще всего выполняются** (hot spots).

**В отличие от логирования или метрик, профайлинг даёт низкоуровневую, детальную картину выполнения кода.**

---

## **2. Для чего он используется**

* **Поиск узких мест (bottlenecks)** — где приложение тратит больше всего CPU или памяти.
* **Оптимизация производительности** — убрать горячие точки, снизить задержки.
* **Анализ утечек памяти** — кто создаёт объекты и кто их держит в памяти.
* **Диагностика зависаний (deadlocks, contention)** — какие потоки блокируются и почему.
* **Проверка гипотез** — соответствует ли реальное поведение кода ожиданиям.

---

## **3. Виды профайлинга**

### **CPU профайлинг**

* Измеряет нагрузку на процессор, время работы методов.
* Методы:

    * **Sampling (Event-based)** — периодический сбор стека вызовов. Быстро, мало влияет на производительность.
    * **Instrumentation** — вставка измеряющего кода в каждый метод. Точнее, но замедляет выполнение.

### **Memory профайлинг**

* Слежение за созданием объектов, GC, утечками памяти, удерживающими ссылками.

### **Thread профайлинг**

* Анализ блокировок, мониторинга состояния потоков (RUNNABLE, BLOCKED, WAITING).

---

## **4. Инструменты для профайлинга Java**

### **Стандартные (в составе JDK)**

* **jconsole** — базовый мониторинг, heap, GC.
* **jvisualvm (VisualVM)** — графики CPU, heap, потоки, snapshot heap dump.
* **jcmd / jmap / jstack** — консольные инструменты для дампов и диагностики.
* **Flight Recorder + JMC (Java Mission Control)** — низкоуровневый профайлинг с минимальной нагрузкой (JFR события).

### **Сторонние инструменты**

* **YourKit Java Profiler** — коммерческий, удобный интерфейс, глубокий анализ.
* **JProfiler** — мощный инструмент для CPU/Memory профайлинга.
* **Async-profiler** — очень быстрый сэмплирующий профайлер, часто используется на проде.
* **Honest Profiler / async-profiler + Flame Graphs** — для генерации flame graph.
* **Eclipse MAT (Memory Analyzer Tool)** — специализированный для анализа heap dump.

---

## **5. Как обычно проводят профайлинг**

1. **Запускают приложение с агентом профайлера** или подключаются удалённо через JMX.
2. **Нагружают приложение** тестовыми или реальными сценариями.
3. **Собирают метрики или snapshot** (CPU / heap dump).
4. **Анализируют отчёт** — какие методы/классы потребляют ресурсы.
5. **Оптимизируют** — убирают лишние аллокации, переписывают горячие участки кода.
6. **Перепроверяют результат профайлингом** (цикл повторяется).

---

## **6. Краткий ответ для собеседования**

> **Профайлинг — это анализ работы приложения во время выполнения.
> Используется для поиска узких мест по CPU, памяти и потокам.
> Методы: sampling (лёгкий) и instrumentation (точный).
> Инструменты: jvisualvm, Java Flight Recorder + Mission Control, YourKit, JProfiler, async-profiler, Eclipse MAT.
> Применяется для оптимизации производительности и поиска утечек.**
