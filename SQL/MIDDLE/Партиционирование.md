# Что такое партиционирование, какие задачи оно решает, по каким правилам выбираются таблицы

## 1. Что такое партиционирование

**Партиционирование** (partitioning) — это разбиение большой таблицы на несколько более мелких частей (**партиций**), которые хранятся и управляются СУБД как единая таблица.

* Для приложения таблица выглядит как одна.
* Для СУБД каждая партиция — отдельный объект (часто со своим файлом на диске).
* Запросы могут работать быстрее, потому что читается только нужная партиция, а не вся таблица.

---

## 2. Какие задачи решает партиционирование

1. **Ускорение запросов**

    * За счёт **partition pruning** (среза): если запрос затрагивает только часть данных, СУБД обращается только к нужной партиции.
    * Например, запрос за последние 7 дней обращается только к партиции за август, а не ко всей 5-летней истории.

2. **Улучшение управления большими данными**

    * Можно архивировать или удалять старые партиции без затрагивания остальных данных.
    * Можно хранить разные партиции на разных дисках/серверах.

3. **Балансировка нагрузки**

    * При распределённом хранении разные партиции можно держать на разных узлах (sharding).

4. **Повышение отказоустойчивости**

    * Повреждение одной партиции не ломает всю таблицу.

---

## 3. Виды партиционирования

1. **Range partitioning (по диапазону)**

    * Деление по интервалам значений.
    * Пример: таблица заказов по датам.

   ```sql
   CREATE TABLE orders (
       id INT,
       created_at DATE
   ) PARTITION BY RANGE (created_at);
   ```

2. **List partitioning (по списку значений)**

    * Каждое значение/группа значений попадает в свою партицию.
    * Пример: таблица клиентов по странам.

3. **Hash partitioning (по хэшу)**

    * Деление по результату хэш-функции (равномерное распределение).
    * Хорошо подходит, если нет "естественного" диапазона.

4. **Composite partitioning (смешанное)**

    * Комбинация (например, сначала по диапазону даты, а внутри по хэшу user\_id).

---

## 4. Как выбирать таблицы для партиционирования

Выбирать стоит таблицы:

1. **Очень большие** (миллионы и миллиарды строк).
2. Которые активно фильтруются по **дате или диапазону значений**.
3. Где удобно работать с архивами (например, логи, заказы, события).
4. Где есть "естественный ключ разреза" (например, `created_at`, `region`, `tenant_id`).
5. Где важна производительность `DELETE/ARCHIVE` (можно просто дропнуть старую партицию вместо долгого удаления строк).

❌ Маленькие таблицы (до сотен тысяч строк) партиционировать обычно не нужно — это только усложнит схему.

---

## 5. Выжимка для собеседования

* **Партиционирование** = разбиение большой таблицы на части (партиции).
* Задачи: ускорение запросов, управление архивами, балансировка нагрузки.
* Виды:

    * **Range** — по диапазону (часто по дате).
    * **List** — по списку значений.
    * **Hash** — равномерное распределение.
    * **Composite** — комбинация.
* Использовать для **больших таблиц**, которые часто фильтруются по дате/ключам.
