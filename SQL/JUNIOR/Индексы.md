# Как работают индексы в БД, какие есть типы

## 1. Что такое индекс

**Индекс** в БД — это специальная структура данных, которая ускоряет поиск строк в таблице по определённым колонкам.
Он работает примерно как указатель в книге: вместо того чтобы читать всю таблицу построчно (**full table scan**), СУБД быстро находит нужные строки по индексу.

---

## 2. Как работают индексы

* Таблица физически хранится как набор строк (в страницах памяти).
* Без индекса: при запросе СУБД читает все строки и проверяет условие (`WHERE`), что медленно.
* С индексом: СУБД сначала ищет в индексе (он обычно хранится в виде **сбалансированного дерева (B-Tree)** или другой структуры), получает адреса нужных строк и напрямую обращается к ним.

---

## 3. Типы индексов

### 1. **B-Tree индекс (основной, по умолчанию)**

* Основан на сбалансированном дереве поиска.
* Эффективен для поиска по `=`, `<`, `>`, `BETWEEN`, `ORDER BY`.
* Самый распространённый (MySQL, PostgreSQL, Oracle).

**Пример:**

```sql
CREATE INDEX idx_users_email ON Users(email);
```

---

### 2. **Хэш-индекс**

* Использует хэш-таблицу.
* Очень быстрый поиск по точному совпадению (`=`).
* Непригоден для диапазонных запросов (`>`, `<`).
* В PostgreSQL есть `USING HASH`.

---

### 3. **Bitmap индекс**

* Хранит битовые карты для каждого уникального значения.
* Эффективен для колонок с **небольшим числом уникальных значений** (например, `gender`, `status`).
* Активно используется в аналитических системах (Oracle, DWH).

---

### 4. **GIN (Generalized Inverted Index)**

* Применяется для поиска по множествам и полнотекстового поиска.
* Хорош для `ARRAY`, `JSONB`, `tsvector` в PostgreSQL.
* Пример: быстрый поиск слов в тексте.

---

### 5. **GiST (Generalized Search Tree)**

* Обобщённая структура для поиска по сложным данным: геоданные, диапазоны, векторы.
* Используется в PostgreSQL для `PostGIS`.

---

### 6. **Clustered Index (кластерный)**

* Данные в таблице физически хранятся в порядке индекса.
* В MySQL (InnoDB) **PRIMARY KEY** всегда кластерный индекс.
* Быстро по PK, но дорогие операции вставки в середину.

---

### 7. **Non-clustered Index (некластерный)**

* Отдельная структура, которая указывает на строки таблицы.
* Может быть несколько таких индексов на таблицу.

---

### 8. **Covering Index (покрывающий)**

* Индекс, содержащий все поля, используемые в запросе.
* Позволяет читать только индекс без обращения к таблице (**Index Only Scan**).

---

## 4. Минусы индексов

* Ускоряют **чтение**, но замедляют **вставку/обновление/удаление**, потому что индекс тоже нужно обновлять.
* Занимают дополнительное место на диске.

---

## 5. Выжимка для собеседования

* **Индекс** — структура для ускорения поиска по колонкам.
* Самый частый — **B-Tree**, хорош для поиска и сортировки.
* **Хэш** — только для `=`.
* **Bitmap** — для колонок с малым числом уникальных значений.
* **GIN/GiST** — для текста, JSON, геоданных.
* **Clustered** — данные упорядочены по индексу (обычно PK).
* **Non-clustered** — отдельная структура ссылок.
* Минусы: занимают место, замедляют записи.
